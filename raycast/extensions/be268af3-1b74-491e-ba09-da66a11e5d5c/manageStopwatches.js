"use strict";var M=Object.defineProperty;var z=Object.getOwnPropertyDescriptor;var K=Object.getOwnPropertyNames;var Q=Object.prototype.hasOwnProperty;var X=(t,e)=>{for(var o in e)M(t,o,{get:e[o],enumerable:!0})},Z=(t,e,o,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of K(e))!Q.call(t,s)&&s!==o&&M(t,s,{get:()=>e[s],enumerable:!(r=z(e,s))||r.enumerable});return t};var tt=t=>Z(M({},"__esModule",{value:!0}),t);var st={};X(st,{default:()=>q});module.exports=tt(st);var n=require("@raycast/api"),G=require("react");var E=require("@raycast/api"),I=require("react");var h=t=>{let e=Math.floor(t/3600),o=String(Math.floor(t%3600/60)).padStart(2,"0"),r=String(Math.floor(t%60)).padStart(2,"0");return`${e===0?"":e+":"}${o}:${r}`},R=t=>{let e=new Date(t),o=[e.getFullYear().toString(),e.getMonth().toString().padStart(2,"0"),e.getDate().toString().padStart(2,"0")],r=[e.getHours(),e.getMinutes(),e.getSeconds()].map(T=>T.toString().padStart(2,"0")),s=o.join("-"),S=r.join(":");return`${s} ${S}`},g=t=>(t.d1=t.d1=="----"?void 0:t.d1,t.d2=t.d2=="----"?void 0:t.d2,Math.round((t.d1?new Date(t.d1):new Date).getTime()-(t.d2?new Date(t.d2):new Date).getTime())/1e3);var f=require("@raycast/api"),L=require("child_process"),A=require("crypto"),a=require("fs"),W=require("path");var p=require("@raycast/api");var C=t=>{let e=(0,p.getPreferenceValues)();if(t.launchedFromMenuBar||e.closeWindowOnTimerStart){let o=t.isErr?"\u26A0\uFE0F":"\u{1F389}";return(0,p.showHUD)(`${o} ${t.msg}`),(0,p.popToRoot)()}else(0,p.showToast)({style:t.isErr?p.Toast.Style.Failure:p.Toast.Style.Success,title:t.msg})};var m=f.environment.supportPath+"/raycast-stopwatches.json",w=()=>{(!(0,a.existsSync)(m)||(0,a.readFileSync)(m).toString()=="")&&(0,a.writeFileSync)(m,"[]")},B=t=>({name:t,swID:(0,A.randomUUID)(),timeStarted:new Date,timeElapsed:-99,lastPaused:"----",pauseElapsed:0}),et=t=>(t.map(e=>{if(e.lastPaused!="----")e.timeElapsed=Math.max(0,g({d1:e.lastPaused,d2:e.timeStarted})-e.pauseElapsed);else{let o=Math.max(0,g({d2:e.timeStarted}));e.timeElapsed=o-e.pauseElapsed}}),t),v=()=>{w();let t=JSON.parse((0,a.readFileSync)(m).toString()),e=ot(t),o=et(e);return o.sort((r,s)=>r.timeElapsed-s.timeElapsed),o},k=async({swName:t="Untitled",launchedFromMenuBar:e=!1})=>{w();let o=JSON.parse((0,a.readFileSync)(m).toString()),r=B(t);o.push(r),(0,a.writeFileSync)(m,JSON.stringify(o)),(0,f.popToRoot)(),C({msg:`Stopwatch "${t}" started!`,launchedFromMenuBar:e,isErr:!1})},U=t=>{w();let e=JSON.parse((0,a.readFileSync)(m).toString());e=e.map(o=>o.swID==t?{...o,lastPaused:new Date}:o),(0,a.writeFileSync)(m,JSON.stringify(e))},V=t=>{w();let e=JSON.parse((0,a.readFileSync)(m).toString());e=e.map(o=>o.swID==t?{...o,pauseElapsed:o.pauseElapsed+g({d2:o.lastPaused}),lastPaused:"----"}:o),(0,a.writeFileSync)(m,JSON.stringify(e))},x=t=>{w();let e=JSON.parse((0,a.readFileSync)(m).toString());e=e.filter(o=>o.swID!==t),(0,a.writeFileSync)(m,JSON.stringify(e))},ot=t=>((0,a.readdirSync)(f.environment.supportPath).forEach(o=>{if((0,W.extname)(o)==".stopwatch"){let r=B((0,a.readFileSync)(f.environment.supportPath+"/"+o).toString()),s=o.replace(/__/g,":").replace(".stopwatch","");r.timeStarted=new Date(s),r.timeElapsed=Math.max(0,g({})),(0,L.execSync)(`rm "${f.environment.supportPath}/${o}"`),t.push(r)}}),(0,a.writeFileSync)(m,JSON.stringify(t)),t),_=(t,e)=>{w();let r=JSON.parse((0,a.readFileSync)(m,"utf8")).map(s=>s.swID==t?{...s,name:e}:s);(0,a.writeFileSync)(m,JSON.stringify(r))};function b(){let[t,e]=(0,I.useState)(void 0),[o,r]=(0,I.useState)(t===void 0),s=()=>{let c=v();e(c),r(!1)},S=c=>{k(c),s()},T=c=>{U(c),s()},N=c=>{V(c),s()},D=c=>{(0,E.getPreferenceValues)().copyOnSwStop&&E.Clipboard.copy(h(c.timeElapsed)),x(c.swID),s()};return{stopwatches:t,isLoading:o,refreshSWes:s,handleRestartSW:c=>{D(c),S({swName:c.name,launchedFromMenuBar:!1}),s()},handleStartSW:S,handleStopSW:D,handlePauseSW:T,handleUnpauseSW:N}}var l=require("@raycast/api");var y=require("@raycast/api");var d=require("fs");var O=y.environment.supportPath+"/customTimers.json",ht=y.environment.supportPath+"/defaultPresetVisibles.json";function j(t,e){let o=y.environment.supportPath+"/"+t;(0,d.writeFileSync)(o,e)}function nt(){(0,d.existsSync)(O)||(0,d.writeFileSync)(O,JSON.stringify({}))}function H(t,e){nt();let o=JSON.parse((0,d.readFileSync)(O,"utf8"));o[t].name=e,(0,d.writeFileSync)(O,JSON.stringify(o))}var P=require("react/jsx-runtime");function F(t){let e=o=>{if(o===""||o===t.currentName)new l.Toast({style:l.Toast.Style.Failure,title:"No new name given!"}).show();else{switch((0,l.popToRoot)(),t.originalFile){case"customTimer":H(t.ctID?t.ctID:"-99",o);break;case"stopwatch":_(t.ctID?t.ctID:"-99",o);break;default:j(t.originalFile,o);break}new l.Toast({style:l.Toast.Style.Success,title:`Renamed to ${o}!`}).show()}};return(0,P.jsx)(l.Form,{actions:(0,P.jsx)(l.ActionPanel,{children:(0,P.jsx)(l.Action.SubmitForm,{title:"Rename",onSubmit:o=>e(o.newName)})}),children:(0,P.jsx)(l.Form.TextField,{id:"newName",title:"New name",placeholder:t.currentName})})}var i=require("react/jsx-runtime");function q(){let{stopwatches:t,isLoading:e,refreshSWes:o,handleRestartSW:r,handleStartSW:s,handleStopSW:S,handlePauseSW:T,handleUnpauseSW:N}=b(),{push:D}=(0,n.useNavigation)();(0,G.useEffect)(()=>{o(),setInterval(()=>{o()},1e3)},[]);let J={tag:{value:"Paused",color:n.Color.Red}},c={tag:{value:"Running",color:n.Color.Green}},$={source:n.Icon.Clock,tintColor:n.Color.Red},Y={source:n.Icon.Clock,tintColor:n.Color.Green};return(0,i.jsx)(n.List,{isLoading:e,children:(0,i.jsxs)(n.List.Section,{title:t?.length!==0&&t!=null?"Currently Running":"No Stopwatches Running",children:[t?.map(u=>(0,i.jsx)(n.List.Item,{icon:u.lastPaused=="----"?Y:$,title:u.name,subtitle:h(u.timeElapsed)+" elapsed",accessories:[{text:"Started at "+R(u.timeStarted)},u.lastPaused=="----"?c:J],actions:(0,i.jsxs)(n.ActionPanel,{children:[u.lastPaused=="----"?(0,i.jsx)(n.Action,{title:"Pause Stopwatch",onAction:()=>T(u.swID)}):(0,i.jsx)(n.Action,{title:"Unpause Stopwatch",onAction:()=>N(u.swID)}),(0,i.jsx)(n.Action,{title:"Rename Stopwatch",onAction:()=>D((0,i.jsx)(F,{currentName:u.name,originalFile:"stopwatch",ctID:u.swID}))}),(0,i.jsx)(n.Action.CopyToClipboard,{title:"Copy Current Time",shortcut:{modifiers:["cmd"],key:"c"},content:h(u.timeElapsed)}),(0,i.jsx)(n.Action,{title:"Restart Stopwatch",shortcut:{modifiers:["cmd"],key:"r"},onAction:()=>r(u)}),(0,i.jsx)(n.Action,{title:"Stop Stopwatch",shortcut:{modifiers:["ctrl"],key:"x"},onAction:()=>S(u)})]})},u.swID)),(0,i.jsx)(n.List.Item,{icon:n.Icon.Clock,title:"Create a new stopwatch",subtitle:"Press Enter to start a stopwatch",actions:(0,i.jsx)(n.ActionPanel,{children:(0,i.jsx)(n.Action,{title:"Start Stopwatch",onAction:()=>s({})})})},0)]})})}
