"use strict";var w=Object.defineProperty;var G=Object.getOwnPropertyDescriptor;var z=Object.getOwnPropertyNames;var K=Object.prototype.hasOwnProperty;var Q=(e,t)=>{for(var s in t)w(e,s,{get:t[s],enumerable:!0})},X=(e,t,s,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let l of z(t))!K.call(e,l)&&l!==s&&w(e,l,{get:()=>t[l],enumerable:!(i=G(t,l))||i.enumerable});return e};var Z=e=>X(w({},"__esModule",{value:!0}),e);var ee={};Q(ee,{default:()=>q});module.exports=Z(ee);var D=require("react");var d=require("@raycast/api"),A=require("child_process"),N=require("crypto"),n=require("fs"),v=require("path");var P=e=>{let t=Math.floor(e/3600),s=String(Math.floor(e%3600/60)).padStart(2,"0"),i=String(Math.floor(e%60)).padStart(2,"0");return`${t===0?"":t+":"}${s}:${i}`};var I=e=>(e.d1=e.d1=="----"?void 0:e.d1,e.d2=e.d2=="----"?void 0:e.d2,Math.round((e.d1?new Date(e.d1):new Date).getTime()-(e.d2?new Date(e.d2):new Date).getTime())/1e3);var c=require("@raycast/api");var O=e=>{let t=(0,c.getPreferenceValues)();if(e.launchedFromMenuBar||t.closeWindowOnTimerStart){let s=e.isErr?"\u26A0\uFE0F":"\u{1F389}";return(0,c.showHUD)(`${s} ${e.msg}`),(0,c.popToRoot)()}else(0,c.showToast)({style:e.isErr?c.Toast.Style.Failure:c.Toast.Style.Success,title:e.msg})};var h=d.environment.supportPath+"/customTimers.json",b=d.environment.supportPath+"/defaultPresetVisibles.json",k=e=>{try{(0,n.unlinkSync)(e)}catch(t){if(t instanceof Error&&!t.message.includes("ENOENT"))throw t}},L=(e=!1)=>{let t=(0,d.getPreferenceValues)();return parseFloat(t.volumeSetting)>5?(O({msg:"Timer alert volume should not be louder than 5 (it can get quite loud!)",launchedFromMenuBar:e,isErr:!0}),!1):!0};async function V({timeInSeconds:e,timerName:t="Untitled",launchedFromMenuBar:s=!1,selectedSound:i="default"}){let m=(d.environment.supportPath+"/"+new Date().toISOString()+"---"+e+".timer").replace(/:/g,"__");(0,n.writeFileSync)(m,t);let u=(0,d.getPreferenceValues)(),y=`${d.environment.assetsPath+"/"+(i==="default"?u.selectedSound:i)}`,g=[`sleep ${e}`];g.push(`if [ -f "${m}" ]; then osascript -e 'display notification "Timer \\"${t}\\" complete" with title "Ding!"'`);let M=`afplay "${y}" --volume ${u.volumeSetting.replace(",",".")}`;if(u.selectedSound==="speak_timer_name"?g.push(`say "${t}"`):g.push(M),u.ringContinuously){let p=`${m}`.replace(".timer",".dismiss");(0,n.writeFileSync)(p,".dismiss file for Timers"),g.push(`while [ -f "${p}" ]; do ${M}; done`)}g.push(`rm "${m}"; else echo "Timer deleted"; fi`),(0,A.exec)(g.join(" && "),(p,r)=>{if(p){console.log(`error: ${p.message}`);return}if(r){console.log(`stderr: ${r}`);return}}),O({msg:`Timer "${t}" started for ${P(e)}!`,launchedFromMenuBar:s,isErr:!1})}function J(e){let t=d.environment.supportPath+"/"+e,s=t.replace(".timer",".dismiss");k(t),k(s)}function x(){let e=[];return(0,n.readdirSync)(d.environment.supportPath).forEach(s=>{if((0,v.extname)(s)==".timer"){let i={name:"",secondsSet:-99,timeLeft:-99,originalFile:s,timeEnds:new Date};i.name=(0,n.readFileSync)(d.environment.supportPath+"/"+s).toString();let l=s.split("---");i.secondsSet=Number(l[1].split(".")[0]);let m=l[0].replace(/__/g,":");i.timeLeft=Math.max(0,Math.round(i.secondsSet-I({d2:m}))),i.timeEnds=new Date(m),i.timeEnds.setSeconds(i.timeEnds.getSeconds()+i.secondsSet),e.push(i)}}),e.sort((s,i)=>s.timeLeft-i.timeLeft),e}function C(){(0,n.existsSync)(h)||(0,n.writeFileSync)(h,JSON.stringify({}))}function R(e){C();let t=JSON.parse((0,n.readFileSync)(h,"utf8"));t[(0,N.randomUUID)()]=e,(0,n.writeFileSync)(h,JSON.stringify(t))}function H(){C();let e=JSON.parse((0,n.readFileSync)(h,"utf8"));return Object.fromEntries(Object.entries(e).map(([t,s])=>s.showInMenuBar===void 0?[t,{...s,showInMenuBar:!0}]:[t,s]))}function _(e){C();let t=JSON.parse((0,n.readFileSync)(h,"utf8"));delete t[e],(0,n.writeFileSync)(h,JSON.stringify(t))}function j(e){C();let t=JSON.parse((0,n.readFileSync)(h,"utf8")),s=t[e].showInMenuBar;t[e].showInMenuBar=s===void 0?!1:!s,(0,n.writeFileSync)(h,JSON.stringify(t))}var U=()=>{if(!(0,n.existsSync)(b)){let t={"2M":!0,"5M":!0,"10M":!0,"15M":!0,"30M":!0,"45M":!0,"60M":!0,"90M":!0};return(0,n.writeFileSync)(b,JSON.stringify(t)),t}return JSON.parse((0,n.readFileSync)(b,"utf8"))},W=e=>{let t=JSON.parse((0,n.readFileSync)(b,"utf8"));t[e]=!t[e],(0,n.writeFileSync)(b,JSON.stringify(t))};var S=require("@raycast/api");function E(){let[e,t]=(0,D.useState)(void 0),[s,i]=(0,D.useState)({}),[l,m]=(0,D.useState)(e===void 0),u=()=>{C();let o=x();t(o);let T=H();i(T),m(!1)};return{timers:e,customTimers:s,isLoading:l,refreshTimers:u,handleStartTimer:o=>{L(o.launchedFromMenuBar)&&(V(o),u())},handleStopTimer:o=>{t(e?.filter(T=>T.originalFile!==o.originalFile)),J(o.originalFile),u()},handleStartCT:({customTimer:o,launchedFromMenuBar:T})=>{L(T)&&(V({timeInSeconds:o.timeInSeconds,launchedFromMenuBar:T,timerName:o.name,selectedSound:o.selectedSound}),u())},handleCreateCT:o=>{let T={name:o.name,timeInSeconds:o.secondsSet,selectedSound:"default",showInMenuBar:!0};R(T),u()},handleDeleteCT:async o=>{let T={title:"Delete this preset?",icon:S.Icon.Trash,message:"You won't be able to recover it.",dismissAction:{title:"Cancel",style:S.Alert.ActionStyle.Cancel},primaryAction:{title:"Delete",style:S.Alert.ActionStyle.Destructive}};await(0,S.confirmAlert)(T)&&(_(o),u())},handleToggleCTVisibility:async o=>{j(o),u()}}}var a=require("@raycast/api"),Y=require("react");var F=require("react");function $(){let e=[{key:"2M",title:"2 Minute Timer",seconds:120},{key:"5M",title:"5 Minute Timer",seconds:300},{key:"10M",title:"10 Minute Timer",seconds:600},{key:"15M",title:"15 Minute Timer",seconds:900},{key:"30M",title:"30 Minute Timer",seconds:1800},{key:"45M",title:"45 Minute Timer",seconds:2700},{key:"60M",title:"60 Minute Timer",seconds:3600},{key:"90M",title:"90 Minute Timer",seconds:5400}],[t,s]=(0,F.useState)(),[i,l]=(0,F.useState)(t===void 0),m=()=>{s(U()),l(!1)};return{defaultPresets:e,defaultVisibles:t,isLoadingVisibles:i,refreshDefaultVisibles:m,handleDefaultPresetToggle:y=>{W(y),m()}}}var f=require("react/jsx-runtime");function q(){let{customTimers:e,isLoading:t,refreshTimers:s,handleToggleCTVisibility:i}=E(),{defaultPresets:l,defaultVisibles:m,isLoadingVisibles:u,refreshDefaultVisibles:y,handleDefaultPresetToggle:g}=$(),M={tag:{value:"Hidden",color:a.Color.Red}},p={tag:{value:"Visible",color:a.Color.Green}};return(0,Y.useEffect)(()=>{s(),y()},[]),(0,f.jsxs)(a.List,{isLoading:t&&u,children:[(0,f.jsx)(a.List.Section,{title:"Custom Presets",children:Object.keys(e).sort((r,B)=>e[r].timeInSeconds-e[B].timeInSeconds).map(r=>(0,f.jsx)(a.List.Item,{title:e[r].name,subtitle:P(e[r].timeInSeconds),icon:a.Icon.Clock,accessories:[e[r].showInMenuBar?p:M],actions:(0,f.jsx)(a.ActionPanel,{children:(0,f.jsx)(a.Action,{title:e[r].showInMenuBar?"Hide In Menu Bar":"Show In Menu Bar",onAction:()=>i(r)})})},r))}),(0,f.jsx)(a.List.Section,{title:"Default Presets",children:l.map(r=>(0,f.jsx)(a.List.Item,{title:r.title,icon:a.Icon.Hourglass,accessories:[m?.[r.key]?p:M],actions:(0,f.jsx)(a.ActionPanel,{children:(0,f.jsx)(a.Action,{title:m?.[r.key]?"Hide In Menu Bar":"Show In Menu Bar",onAction:()=>g(r.key)})})},r.key))})]})}
