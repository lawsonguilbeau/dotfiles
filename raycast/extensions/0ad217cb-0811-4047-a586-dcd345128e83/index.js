"use strict";var fe=Object.create;var V=Object.defineProperty;var de=Object.getOwnPropertyDescriptor;var he=Object.getOwnPropertyNames;var pe=Object.getPrototypeOf,me=Object.prototype.hasOwnProperty;var ge=(r,n)=>{for(var t in n)V(r,t,{get:n[t],enumerable:!0})},K=(r,n,t,e)=>{if(n&&typeof n=="object"||typeof n=="function")for(let i of he(n))!me.call(r,i)&&i!==t&&V(r,i,{get:()=>n[i],enumerable:!(e=de(n,i))||e.enumerable});return r};var R=(r,n,t)=>(t=r!=null?fe(pe(r)):{},K(n||!r||!r.__esModule?V(t,"default",{value:r,enumerable:!0}):t,r)),be=r=>K(V({},"__esModule",{value:!0}),r);var Te={};ge(Te,{default:()=>se});module.exports=be(Te);var o=require("@raycast/api");var l=R(require("react")),p=require("@raycast/api");var J=Object.prototype.hasOwnProperty;function N(r,n){var t,e;if(r===n)return!0;if(r&&n&&(t=r.constructor)===n.constructor){if(t===Date)return r.getTime()===n.getTime();if(t===RegExp)return r.toString()===n.toString();if(t===Array){if((e=r.length)===n.length)for(;e--&&N(r[e],n[e]););return e===-1}if(!t||typeof r=="object"){e=0;for(t in r)if(J.call(r,t)&&++e&&!J.call(n,t)||!(t in n)||!N(r[t],n[t]))return!1;return Object.keys(n).length===e}}return r!==r&&n!==n}var _=R(require("node:fs")),j=R(require("node:path")),X=R(require("node:crypto"));var Q=require("react/jsx-runtime");function $e(r){let n=(0,l.useRef)(r),t=(0,l.useRef)(0);return N(r,n.current)||(n.current=r,t.current+=1),(0,l.useMemo)(()=>n.current,[t.current])}function A(r){let n=(0,l.useRef)(r);return n.current=r,n}function B(r,n){let t=r instanceof Error?r.message:String(r);return(0,p.showToast)({style:p.Toast.Style.Failure,title:n?.title??"Something went wrong",message:n?.message??t,primaryAction:n?.primaryAction??H(r),secondaryAction:n?.primaryAction?H(r):void 0})}var H=r=>{let n=!0,t="[Extension Name]...",e="";try{let c=JSON.parse((0,_.readFileSync)((0,j.join)(p.environment.assetsPath,"..","package.json"),"utf8"));t=`[${c.title}]...`,e=`https://raycast.com/${c.owner||c.author}/${c.name}`,(!c.owner||c.access==="public")&&(n=!1)}catch{}let i=p.environment.isDevelopment||n,h=r instanceof Error?r?.stack||r?.message||"":String(r);return{title:i?"Copy Logs":"Report Error",onAction(c){c.hide(),i?p.Clipboard.copy(h):(0,p.open)(`https://github.com/raycast/extensions/issues/new?&labels=extension%2Cbug&template=extension_bug_report.yml&title=${encodeURIComponent(t)}&extension-url=${encodeURI(e)}&description=${encodeURIComponent(`#### Error:
\`\`\`
${h}
\`\`\`
`)}`)}}};function ye(r,n,t){let e=(0,l.useRef)(0),[i,h]=(0,l.useState)({isLoading:!0}),c=A(r),m=A(t?.abortable),a=A(n||[]),u=A(t?.onError),s=A(t?.onData),f=A(t?.onWillExecute),S=A(t?.failureToastOptions),w=A(i.data),k=(0,l.useRef)(null),g=(0,l.useRef)({page:0}),x=(0,l.useRef)(!1),E=(0,l.useRef)(!0),U=(0,l.useRef)(50),y=(0,l.useCallback)(()=>(m.current&&(m.current.current?.abort(),m.current.current=new AbortController),++e.current),[m]),b=(0,l.useCallback)((...C)=>{let v=y();f.current?.(C),h(d=>({...d,isLoading:!0}));let O=we(c.current)(...C);function L(d){return d.name=="AbortError"||v===e.current&&(u.current?u.current(d):p.environment.launchType!==p.LaunchType.Background&&B(d,{title:"Failed to fetch latest data",primaryAction:{title:"Retry",onAction(T){T.hide(),k.current?.(...a.current||[])}},...S.current}),h({error:d,isLoading:!1})),d}return typeof O=="function"?(x.current=!0,O(g.current).then(({data:d,hasMore:T,cursor:le})=>(v===e.current&&(g.current&&(g.current.cursor=le,g.current.lastItem=d?.[d.length-1]),s.current&&s.current(d,g.current),T&&(U.current=d.length),E.current=T,h(ue=>g.current.page===0?{data:d,isLoading:!1}:{data:(ue.data||[])?.concat(d),isLoading:!1})),d),d=>(E.current=!1,L(d)))):(x.current=!1,O.then(d=>(v===e.current&&(s.current&&s.current(d),h({data:d,isLoading:!1})),d),L))},[s,u,a,c,h,k,f,g,S,y]);k.current=b;let P=(0,l.useCallback)(()=>{g.current={page:0};let C=a.current||[];return b(...C)},[b,a]),I=(0,l.useCallback)(async(C,v)=>{let O;try{if(v?.optimisticUpdate){y(),typeof v?.rollbackOnError!="function"&&v?.rollbackOnError!==!1&&(O=structuredClone(w.current?.value));let L=v.optimisticUpdate;h(d=>({...d,data:L(d.data)}))}return await C}catch(L){if(typeof v?.rollbackOnError=="function"){let d=v.rollbackOnError;h(T=>({...T,data:d(T.data)}))}else v?.optimisticUpdate&&v?.rollbackOnError!==!1&&h(d=>({...d,data:O}));throw L}finally{v?.shouldRevalidateAfter!==!1&&(p.environment.launchType===p.LaunchType.Background||p.environment.commandMode==="menu-bar"?await P():P())}},[P,w,h,y]),z=(0,l.useCallback)(()=>{g.current.page+=1;let C=a.current||[];b(...C)},[g,a,b]);(0,l.useEffect)(()=>{g.current={page:0},t?.execute!==!1?b(...n||[]):y()},[$e([n,t?.execute,b]),m,g]),(0,l.useEffect)(()=>()=>{y()},[y]);let ie=t?.execute!==!1?i.isLoading:!1,oe={...i,isLoading:ie},ce=x.current?{pageSize:U.current,hasMore:E.current,onLoadMore:z}:void 0;return{...oe,revalidate:P,mutate:I,pagination:ce}}function we(r){return r===Promise.all||r===Promise.race||r===Promise.resolve||r===Promise.reject?r.bind(Promise):r}function Z(r){return typeof r!="function"?!1:/^function\s+\w*\s*\(\s*\)\s*{\s+\[native code\]\s+}$/i.exec(Function.prototype.toString.call(r))!==null}function ke(r){return r instanceof URLSearchParams?r.toString():r}function ee(r,n=[]){function t(e){return"update"in r?r.update(e,"utf8"):r.write(e)}return{dispatch:function(e){e=ke(e),e===null?this._null():this["_"+typeof e](e)},_object:function(e){let i=/\[object (.*)\]/i,h=Object.prototype.toString.call(e),c=i.exec(h)?.[1]??"unknown:["+h+"]";c=c.toLowerCase();let m=null;if((m=n.indexOf(e))>=0){this.dispatch("[CIRCULAR:"+m+"]");return}else n.push(e);if(Buffer.isBuffer(e))return t("buffer:"),t(e.toString("utf8"));if(c!=="object"&&c!=="function"&&c!=="asyncfunction")if(this["_"+c])this["_"+c](e);else throw new Error('Unknown object type "'+c+'"');else{let a=Object.keys(e);a=a.sort(),Z(e)||a.splice(0,0,"prototype","__proto__","constructor"),t("object:"+a.length+":");let u=this;return a.forEach(function(s){u.dispatch(s),t(":"),u.dispatch(e[s]),t(",")})}},_array:function(e,i){i=typeof i<"u"?i:!1;let h=this;if(t("array:"+e.length+":"),!i||e.length<=1){e.forEach(function(a){h.dispatch(a)});return}let c=[],m=e.map(function(a){let u=xe(),s=n.slice();return ee(u,s).dispatch(a),c=c.concat(s.slice(n.length)),u.read().toString()});n=n.concat(c),m.sort(),this._array(m,!1)},_date:function(e){t("date:"+e.toJSON())},_symbol:function(e){t("symbol:"+e.toString())},_error:function(e){t("error:"+e.toString())},_boolean:function(e){t("bool:"+e.toString())},_string:function(e){t("string:"+e.length+":"),t(e.toString())},_function:function(e){t("fn:"),Z(e)?this.dispatch("[native]"):this.dispatch(e.toString()),this.dispatch("function-name:"+String(e.name)),this._object(e)},_number:function(e){t("number:"+e.toString())},_xml:function(e){t("xml:"+e.toString())},_null:function(){t("Null")},_undefined:function(){t("Undefined")},_regexp:function(e){t("regex:"+e.toString())},_uint8array:function(e){t("uint8array:"),this.dispatch(Array.prototype.slice.call(e))},_uint8clampedarray:function(e){t("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(e))},_int8array:function(e){t("int8array:"),this.dispatch(Array.prototype.slice.call(e))},_uint16array:function(e){t("uint16array:"),this.dispatch(Array.prototype.slice.call(e))},_int16array:function(e){t("int16array:"),this.dispatch(Array.prototype.slice.call(e))},_uint32array:function(e){t("uint32array:"),this.dispatch(Array.prototype.slice.call(e))},_int32array:function(e){t("int32array:"),this.dispatch(Array.prototype.slice.call(e))},_float32array:function(e){t("float32array:"),this.dispatch(Array.prototype.slice.call(e))},_float64array:function(e){t("float64array:"),this.dispatch(Array.prototype.slice.call(e))},_arraybuffer:function(e){t("arraybuffer:"),this.dispatch(new Uint8Array(e))},_url:function(e){t("url:"+e.toString())},_map:function(e){t("map:");let i=Array.from(e);this._array(i,!0)},_set:function(e){t("set:");let i=Array.from(e);this._array(i,!0)},_file:function(e){t("file:"),this.dispatch([e.name,e.size,e.type,e.lastModified])},_blob:function(){throw Error(`Hashing Blob objects is currently not supported
(see https://github.com/puleos/object-hash/issues/26)
Use "options.replacer" or "options.ignoreUnknown"
`)},_domwindow:function(){t("domwindow")},_bigint:function(e){t("bigint:"+e.toString())},_process:function(){t("process")},_timer:function(){t("timer")},_pipe:function(){t("pipe")},_tcp:function(){t("tcp")},_udp:function(){t("udp")},_tty:function(){t("tty")},_statwatcher:function(){t("statwatcher")},_securecontext:function(){t("securecontext")},_connection:function(){t("connection")},_zlib:function(){t("zlib")},_context:function(){t("context")},_nodescript:function(){t("nodescript")},_httpparser:function(){t("httpparser")},_dataview:function(){t("dataview")},_signal:function(){t("signal")},_fsevent:function(){t("fsevent")},_tlswrap:function(){t("tlswrap")}}}function xe(){return{buf:"",write:function(r){this.buf+=r},end:function(r){this.buf+=r},read:function(){return this.buf}}}function ve(r,n){let t=this[r];return t instanceof Date?`__raycast_cached_date__${t.toString()}`:Buffer.isBuffer(t)?`__raycast_cached_buffer__${t.toString("base64")}`:n}function Se(r,n){return typeof n=="string"&&n.startsWith("__raycast_cached_date__")?new Date(n.replace("__raycast_cached_date__","")):typeof n=="string"&&n.startsWith("__raycast_cached_buffer__")?Buffer.from(n.replace("__raycast_cached_buffer__",""),"base64"):n}function q(r){let n=X.default.createHash("sha1");return ee(n).dispatch(r),n.digest("hex")}var Ee=Symbol("cache without namespace"),Y=new Map;function Ae(r,n,t){let e=t?.cacheNamespace||Ee,i=Y.get(e)||Y.set(e,new p.Cache({namespace:t?.cacheNamespace})).get(e);if(!i)throw new Error("Missing cache");let h=A(r),c=A(n),m=(0,l.useSyncExternalStore)(i.subscribe,()=>{try{return i.get(h.current)}catch(f){console.error("Could not get Cache data:",f);return}}),a=(0,l.useMemo)(()=>{if(typeof m<"u"){if(m==="undefined")return;try{return JSON.parse(m,Se)}catch(f){return console.warn("The cached data is corrupted",f),c.current}}else return c.current},[m,c]),u=A(a),s=(0,l.useCallback)(f=>{let S=typeof f=="function"?f(u.current):f;if(typeof S>"u")i.set(h.current,"undefined");else{let w=JSON.stringify(S,ve);i.set(h.current,w)}return S},[i,h,u]);return[a,s]}var D=Symbol();function te(r,n,t){let{initialData:e,keepPreviousData:i,internal_cacheKeySuffix:h,...c}=t||{},m=(0,l.useRef)(null),[a,u]=Ae(q(n||[])+h,D,{cacheNamespace:q(r)}),s=(0,l.useRef)(a!==D?a:e),f=(0,l.useRef)(void 0),{mutate:S,revalidate:w,...k}=ye(r,n||[],{...c,onData(y,b){f.current=b,c.onData&&c.onData(y,b),!(b&&b.page>0)&&(m.current="promise",s.current=y,u(y))}}),g,x=k.pagination;f.current&&f.current.page>0&&k.data?g=k.data:m.current==="promise"?g=s.current:i&&a!==D?(g=a,x&&(x.hasMore=!0,x.pageSize=a.length)):i&&a===D?g=s.current:a!==D?(g=a,x&&(x.hasMore=!0,x.pageSize=a.length)):g=e;let E=A(g),U=(0,l.useCallback)(async(y,b)=>{let P;try{if(b?.optimisticUpdate){typeof b?.rollbackOnError!="function"&&b?.rollbackOnError!==!1&&(P=structuredClone(E.current));let I=b.optimisticUpdate(E.current);m.current="cache",s.current=I,u(I)}return await S(y,{shouldRevalidateAfter:b?.shouldRevalidateAfter})}catch(I){if(typeof b?.rollbackOnError=="function"){let z=b.rollbackOnError(E.current);m.current="cache",s.current=z,u(z)}else b?.optimisticUpdate&&b?.rollbackOnError!==!1&&(m.current="cache",s.current=P,u(P));throw I}},[u,S,E,s,m]);return(0,l.useEffect)(()=>{a!==D&&(m.current="cache",s.current=a)},[a]),{data:g,isLoading:k.isLoading,error:k.error,mutate:f.current&&f.current.page>0?S:U,pagination:x,revalidate:w}}var W=require("react");var re=[{id:"all",name:"All"},{id:"store",name:"Store"},{id:"local",name:"Local"}];function G(r,n){return(n||"{title} ({link})").replaceAll("{title}",r.title).replaceAll("{link}",r.link).replaceAll("{author}",r.author)}function ne(r,n,t,e){let i=t==="newline"?`
`:", ";return(e?`${e}
`:"").replaceAll("{count}",r.length.toString())+r.map(c=>G(c,n)).join(i)}var M=R(require("fs/promises")),ae=R(require("os")),F=R(require("path")),$=require("react/jsx-runtime");async function Pe(){try{let r=F.default.join(ae.default.homedir(),".config","raycast","extensions"),n=await M.default.readdir(r);return(await Promise.all(n.map(async e=>{let i=F.default.join(r,e,"package.json");try{return await M.default.access(i,M.default.constants.F_OK),i}catch{return null}}))).filter(e=>e!==null)}catch(r){throw r instanceof Error?(B(r.message),new Error(r.message)):new Error("An unknown error occurred")}}function Ce(r){let[n,t]=(0,W.useState)();return(0,W.useEffect)(()=>{(0,o.getDefaultApplication)(r.url).then(e=>t(e)).catch(()=>t(void 0))},[r.url]),n?(0,$.jsx)(o.Action.Open,{title:`Open Manifest in ${n.name}`,target:r.url,icon:{fileIcon:n.path},shortcut:{modifiers:["cmd","shift"],key:"m"}}):null}function se(){let r=(0,o.getPreferenceValues)(),[n,t]=(0,W.useState)([]),{isLoading:e,data:i,error:h}=te(async()=>{let a=await Pe(),u=await Promise.all(a.map(async s=>{let f=await M.default.readFile(s,"utf-8"),S=await M.default.stat(s),w=JSON.parse(f),k=w.author,g=w?.owner,x=w?.access,E=w.name,U=`https://raycast.com/${g??k}/${E}`,y=s.replace("/package.json","");return{path:y,name:E,author:k,icon:w.icon,commandCount:w.commands.length,owner:g,access:x,title:w.title,handle:`${g??k}/${E}`,link:U,created:S.ctime,isLocalExtension:!/[\da-f]{8}-[\da-f]{4}-[\da-f]{4}-[\da-f]{4}-[\da-f]{12}/gi.test(y)}}));return u=u.filter(s=>s.title!==""&&s.author!==""),u=u.sort((s,f)=>s.title.localeCompare(f.title)),t(u),u});function c(a){let{ExtensionTypes:u,onExtensionTypeChange:s}=a;return(0,$.jsx)(o.List.Dropdown,{tooltip:"Select Extension Type",storeValue:!1,onChange:f=>{s(f)},children:(0,$.jsx)(o.List.Dropdown.Section,{title:"Extension Type",children:u.map(f=>(0,$.jsx)(o.List.Dropdown.Item,{title:f.name,value:f.id},f.id))})})}return(0,$.jsxs)(o.List,{isLoading:e,searchBarAccessory:(0,$.jsx)(c,{ExtensionTypes:re,onExtensionTypeChange:a=>{let u=i?.filter(s=>a==="local"?s.isLocalExtension:a==="store"?!s.isLocalExtension:!0)||[];t(u)}}),children:[(0,$.jsx)(o.List.EmptyView,{title:h?"An Error Occurred":"No Results",icon:h?{source:o.Icon.Warning,tintColor:o.Color.Red}:"noview.png"}),(0,$.jsx)(o.List.Section,{title:"Installed Extensions",subtitle:`${n?.length}`,children:n&&n.map((a,u)=>{let s=[];a.isLocalExtension&&s.push({tag:{color:o.Color.Green,value:"Local extension"},icon:o.Icon.HardDrive}),a.owner?s.push({tag:a.owner,icon:o.Icon.Crown,tooltip:"Organization"}):s.push({tag:a.author,icon:o.Icon.Person,tooltip:"Author"}),a.owner&&a.access===void 0&&s.push({tag:{color:o.Color.Red,value:"Private"},icon:o.Icon.EyeDisabled,tooltip:"Private Extension"});let f=new Date(a.created);return s.push({tag:`${a.commandCount}`,icon:o.Icon.ComputerChip,tooltip:"Commands"}),s.push({date:f,tooltip:`Last updated: ${f.toLocaleString()}`}),(0,$.jsx)(o.List.Item,{icon:`${a.path}/assets/${a.icon}`,title:a.title,keywords:[a.author],actions:(0,$.jsxs)(o.ActionPanel,{children:[(0,$.jsxs)(o.ActionPanel.Section,{title:"Extension",children:[(0,$.jsx)(o.Action,{icon:o.Icon.Play,title:"Launch Extension",onAction:()=>{(0,o.open)(`raycast://extensions/${a.handle}`)}}),(0,$.jsx)(o.Action.OpenInBrowser,{url:a.link}),(0,$.jsx)(o.Action.CopyToClipboard,{title:"Copy Item to Clipboard",content:G(a,r.format),shortcut:{modifiers:["cmd"],key:"."}}),(0,$.jsx)(o.Action.CopyToClipboard,{title:"Copy Extension List to Clipboard",content:ne(n,r.format,r.separator,r.prepend),shortcut:{modifiers:["cmd","shift"],key:"."}})]}),(0,$.jsx)(o.ActionPanel.Section,{children:(0,$.jsx)(Ce,{url:F.default.join(a.path,"package.json")})}),(0,$.jsx)(o.Action,{title:"Open Extension Preferences",onAction:o.openExtensionPreferences,icon:o.Icon.Gear,shortcut:{modifiers:["cmd","shift"],key:","}})]}),accessories:s},u)})})]})}
